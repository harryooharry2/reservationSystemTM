---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Make a Reservation - Cafe Reservation System">
  <div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-primary-400 mb-4">Make a Reservation</h1>
      <p class="text-secondary-300 text-lg">
        Choose your preferred date, time, and table for a perfect dining experience
      </p>
    </div>

    <!-- Reservation Wizard -->
    <div id="reservation-wizard" class="max-w-4xl mx-auto">
      <!-- Step 1: Date & Time Selection -->
      <div id="step-1" class="reservation-step active">
        <div class="bg-card rounded-lg shadow-lg p-6 mb-6">
          <h2 class="text-2xl font-semibold text-primary-400 mb-4">Step 1: Select Date & Time</h2>
          
          <!-- Date Selection -->
          <div class="mb-6">
            <label for="reservation-date" class="block text-secondary-200 font-medium mb-2">
              Reservation Date
            </label>
            <input 
              type="date" 
              id="reservation-date" 
              class="form-input w-full"
              min=""
              required
            >
            <p class="text-sm text-secondary-400 mt-1">
              Reservations can be made up to 3 months in advance
            </p>
          </div>

          <!-- Time Selection -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="start-time" class="block text-secondary-200 font-medium mb-2">
                Start Time
              </label>
              <select id="start-time" class="form-input w-full" required>
                <option value="">Select start time</option>
                <!-- Time slots will be populated by JavaScript -->
              </select>
            </div>
            <div>
              <label for="end-time" class="block text-secondary-200 font-medium mb-2">
                End Time
              </label>
              <select id="end-time" class="form-input w-full" required>
                <option value="">Select end time</option>
                <!-- Time slots will be populated by JavaScript -->
              </select>
            </div>
          </div>

          <!-- Party Size -->
          <div class="mt-6">
            <label for="party-size" class="block text-secondary-200 font-medium mb-2">
              Party Size
            </label>
            <select id="party-size" class="form-input w-full" required>
              <option value="">Select party size</option>
              <option value="1">1 person</option>
              <option value="2">2 people</option>
              <option value="3">3 people</option>
              <option value="4">4 people</option>
              <option value="5">5 people</option>
              <option value="6">6 people</option>
              <option value="7">7 people</option>
              <option value="8">8 people</option>
              <option value="9">9 people</option>
              <option value="10">10 people</option>
            </select>
          </div>

          <div class="mt-6">
            <button 
              id="check-availability" 
              class="btn-primary w-full md:w-auto"
              disabled
            >
              Check Availability
            </button>
          </div>
        </div>
      </div>

      <!-- Step 2: Table Selection -->
      <div id="step-2" class="reservation-step hidden">
        <div class="bg-card rounded-lg shadow-lg p-6 mb-6">
          <h2 class="text-2xl font-semibold text-primary-400 mb-4">Step 2: Select Your Table</h2>
          
          <!-- Availability Summary -->
          <div id="availability-summary" class="mb-6 p-4 bg-secondary-800 rounded-lg">
            <h3 class="text-lg font-medium text-secondary-200 mb-2">Reservation Details</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
              <div>
                <span class="text-secondary-400">Date:</span>
                <span id="summary-date" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Time:</span>
                <span id="summary-time" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Party Size:</span>
                <span id="summary-party" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Available Tables:</span>
                <span id="summary-count" class="text-secondary-200 ml-2"></span>
              </div>
            </div>
          </div>

          <!-- Table Grid -->
          <div id="table-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
            <!-- Tables will be populated by JavaScript -->
          </div>

          <!-- Navigation -->
          <div class="flex justify-between">
            <button id="back-to-step-1" class="btn-secondary">
              ← Back to Date & Time
            </button>
            <button id="proceed-to-step-3" class="btn-primary" disabled>
              Continue to Details →
            </button>
          </div>
        </div>
      </div>

      <!-- Step 3: Booking Details -->
      <div id="step-3" class="reservation-step hidden">
        <div class="bg-card rounded-lg shadow-lg p-6 mb-6">
          <h2 class="text-2xl font-semibold text-primary-400 mb-4">Step 3: Booking Details</h2>
          
          <!-- Selected Table Summary -->
          <div id="selected-table-summary" class="mb-6 p-4 bg-primary-900/20 rounded-lg border border-primary-500/30">
            <h3 class="text-lg font-medium text-primary-400 mb-2">Selected Table</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
              <div>
                <span class="text-secondary-400">Table:</span>
                <span id="selected-table-number" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Capacity:</span>
                <span id="selected-table-capacity" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Date:</span>
                <span id="selected-date" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Time:</span>
                <span id="selected-time" class="text-secondary-200 ml-2"></span>
              </div>
            </div>
          </div>

          <!-- Booking Form -->
          <form id="booking-form" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="customer-name" class="block text-secondary-200 font-medium mb-2">
                  Full Name *
                </label>
                <input 
                  type="text" 
                  id="customer-name" 
                  class="form-input w-full"
                  required
                >
              </div>
              <div>
                <label for="customer-email" class="block text-secondary-200 font-medium mb-2">
                  Email Address *
                </label>
                <input 
                  type="email" 
                  id="customer-email" 
                  class="form-input w-full"
                  required
                >
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="customer-phone" class="block text-secondary-200 font-medium mb-2">
                  Phone Number
                </label>
                <input 
                  type="tel" 
                  id="customer-phone" 
                  class="form-input w-full"
                >
              </div>
              <div>
                <label for="special-requests" class="block text-secondary-200 font-medium mb-2">
                  Special Requests
                </label>
                <select id="special-requests" class="form-input w-full">
                  <option value="">No special requests</option>
                  <option value="window-seat">Window seat preferred</option>
                  <option value="quiet-area">Quiet area preferred</option>
                  <option value="high-chair">High chair needed</option>
                  <option value="wheelchair-access">Wheelchair accessible table</option>
                  <option value="other">Other (specify in notes)</option>
                </select>
              </div>
            </div>

            <div>
              <label for="notes" class="block text-secondary-200 font-medium mb-2">
                Additional Notes
              </label>
              <textarea 
                id="notes" 
                rows="3" 
                class="form-input w-full"
                placeholder="Any additional information or special requests..."
              ></textarea>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between pt-6">
              <button type="button" id="back-to-step-2" class="btn-secondary">
                ← Back to Table Selection
              </button>
              <button type="submit" id="confirm-booking" class="btn-primary">
                Confirm Reservation
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Step 4: Confirmation -->
      <div id="step-4" class="reservation-step hidden">
        <div class="bg-card rounded-lg shadow-lg p-6 text-center">
          <div class="mb-6">
            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
            <h2 class="text-2xl font-semibold text-primary-400 mb-2">Reservation Confirmed!</h2>
            <p class="text-secondary-300">
              Your reservation has been successfully booked. You will receive a confirmation email shortly.
            </p>
          </div>

          <!-- Confirmation Details -->
          <div id="confirmation-details" class="bg-secondary-800 rounded-lg p-6 mb-6 text-left">
            <h3 class="text-lg font-medium text-secondary-200 mb-4">Reservation Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <div>
                <span class="text-secondary-400">Confirmation #:</span>
                <span id="confirmation-number" class="text-secondary-200 ml-2 font-mono"></span>
              </div>
              <div>
                <span class="text-secondary-400">Table:</span>
                <span id="confirmation-table" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Date:</span>
                <span id="confirmation-date" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Time:</span>
                <span id="confirmation-time" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Party Size:</span>
                <span id="confirmation-party" class="text-secondary-200 ml-2"></span>
              </div>
              <div>
                <span class="text-secondary-400">Name:</span>
                <span id="confirmation-name" class="text-secondary-200 ml-2"></span>
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <button id="new-reservation" class="btn-primary">
              Make Another Reservation
            </button>
            <button id="view-reservations" class="btn-secondary">
              View My Reservations
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-card rounded-lg p-6 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-400 mx-auto mb-4"></div>
        <p class="text-secondary-200">Processing your reservation...</p>
      </div>
    </div>

    <!-- Skeleton Loading States -->
    <div id="skeleton-loading" class="hidden">
      <!-- Step 1 Skeleton -->
      <div id="step-1-skeleton" class="reservation-step">
        <div class="bg-card rounded-lg shadow-lg p-6 mb-6 animate-pulse">
          <div class="h-8 bg-secondary-700 rounded mb-4"></div>
          <div class="space-y-4">
            <div class="h-4 bg-secondary-700 rounded w-1/3"></div>
            <div class="h-12 bg-secondary-700 rounded"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="h-12 bg-secondary-700 rounded"></div>
              <div class="h-12 bg-secondary-700 rounded"></div>
            </div>
            <div class="h-12 bg-secondary-700 rounded"></div>
            <div class="h-12 bg-secondary-700 rounded w-1/2"></div>
          </div>
        </div>
      </div>

      <!-- Step 2 Skeleton -->
      <div id="step-2-skeleton" class="reservation-step">
        <div class="bg-card rounded-lg shadow-lg p-6 mb-6 animate-pulse">
          <div class="h-8 bg-secondary-700 rounded mb-4"></div>
          <div class="h-20 bg-secondary-700 rounded mb-6"></div>
          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            {Array.from({ length: 8 }).map(() => (
              <div class="h-24 bg-secondary-700 rounded"></div>
            ))}
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Indicator -->
    <div class="max-w-4xl mx-auto mb-8">
      <div class="flex items-center justify-between">
        {[1, 2, 3, 4].map((step) => (
          <div class="flex items-center">
            <div 
              id={`progress-step-${step}`}
              class="w-10 h-10 rounded-full border-2 flex items-center justify-center text-sm font-medium transition-all duration-300"
            >
              {step}
            </div>
            {step < 4 && (
              <div 
                id={`progress-line-${step}`}
                class="w-16 h-1 bg-secondary-700 mx-2 transition-all duration-300"
              ></div>
            )}
          </div>
        ))}
      </div>
      <div class="flex justify-between mt-2 text-xs text-secondary-400">
        <span>Date & Time</span>
        <span>Select Table</span>
        <span>Details</span>
        <span>Confirm</span>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .reservation-step {
    transition: all 0.3s ease-in-out;
  }
  
  .reservation-step.hidden {
    display: none;
  }
  
  .reservation-step.active {
    display: block;
  }
  
  .table-card {
    transition: all 0.2s ease-in-out;
  }
  
  .table-card:hover {
    transform: translateY(-2px);
  }
  
  .table-card.selected {
    border-color: #8b5cf6;
    background-color: rgba(139, 92, 246, 0.1);
  }
  
  .table-card.available {
    border-color: #10b981;
  }
  
  .table-card.unavailable {
    border-color: #ef4444;
    opacity: 0.6;
  }

  /* Form validation styles */
  .form-input.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }

  .form-input.error:focus {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
  }

  .error-message {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  /* Loading states */
  .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .btn-primary.loading {
    position: relative;
    color: transparent;
  }

  .btn-primary.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 1rem;
    height: 1rem;
    margin: -0.5rem 0 0 -0.5rem;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Progress indicator styles */
  .progress-step {
    transition: all 0.3s ease-in-out;
  }

  .progress-step.active {
    background-color: #8b5cf6;
    border-color: #8b5cf6;
    color: white;
  }

  .progress-step.completed {
    background-color: #10b981;
    border-color: #10b981;
    color: white;
  }

  .progress-line.active {
    background-color: #8b5cf6;
  }

  .progress-line.completed {
    background-color: #10b981;
  }

  /* Smooth transitions */
  .form-input {
    transition: all 0.2s ease-in-out;
  }

  .btn-primary, .btn-secondary {
    transition: all 0.2s ease-in-out;
  }

  /* Responsive improvements */
  @media (max-width: 768px) {
    .reservation-step {
      padding: 1rem;
    }
    
    .table-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .progress-indicator {
      flex-direction: column;
      gap: 1rem;
    }

    .progress-lines {
      display: none;
    }
  }

  /* Accessibility improvements */
  .form-input:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
  }

  .table-card:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
  }

  /* Screen reader only text */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .table-card {
      border-width: 3px;
    }

    .form-input {
      border-width: 2px;
    }

    .btn-primary, .btn-secondary {
      border-width: 2px;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .reservation-step,
    .table-card,
    .form-input,
    .btn-primary,
    .btn-secondary {
      transition: none;
    }

    .table-card:hover {
      transform: none;
    }

    @keyframes spin {
      to {
        transform: none;
      }
    }
  }

  /* Dark mode optimizations */
  @media (prefers-color-scheme: dark) {
    .form-input {
      background-color: #1f2937;
      border-color: #374151;
    }

    .form-input:focus {
      border-color: #8b5cf6;
    }
  }

  /* Performance optimizations */
  .table-card {
    will-change: transform;
  }

  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: .5;
    }
  }

  /* Focus management */
  .table-card:focus-visible {
    outline: 2px solid #8b5cf6;
    outline-offset: 2px;
  }

  /* Keyboard navigation improvements */
  .table-card[tabindex]:focus {
    outline: 2px solid #8b5cf6;
    outline-offset: 2px;
  }

  /* Loading skeleton animations */
  .skeleton {
    background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* Toast notifications */
  .toast {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 1000;
    max-width: 24rem;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
  }

  .toast.show {
    transform: translateX(0);
  }

  .toast.success {
    background-color: #10b981;
    color: white;
  }

  .toast.error {
    background-color: #ef4444;
    color: white;
  }

  .toast.warning {
    background-color: #f59e0b;
    color: white;
  }

  .toast.info {
    background-color: #3b82f6;
    color: white;
  }
</style>

<script>
  // Reservation system JavaScript will be loaded here
  import { initializeReservationSystem } from '../lib/reservation.js';
  
  // Initialize the reservation system when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    initializeReservationSystem();
  });
</script>