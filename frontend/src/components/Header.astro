---
// Header component with responsive navigation
import { supabase } from '../lib/supabase.js';

// Check if user is authenticated and has admin role
let isAdmin = false;
let isAuthenticated = false;

try {
  const { data: { user } } = await supabase.auth.getUser();
  if (user) {
    isAuthenticated = true;
    const { data: userProfile } = await supabase
      .from('users')
      .select('role')
      .eq('id', user.id)
      .single();
    
    isAdmin = userProfile?.role === 'admin';
  }
} catch (error) {
  console.error('Error checking user role:', error);
}
---

<header class="bg-secondary-900 text-white border-b border-secondary-800 sticky top-0 z-40 md:z-30">
  <div class="container-responsive py-3 flex items-center gap-3">
    <!-- Mobile: sidebar hamburger -->
    <button id="sidebarToggle" aria-label="Open sidebar" aria-expanded="false" class="md:hidden p-2 rounded-lg text-secondary-200 hover:text-white hover:bg-secondary-800">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <!-- Brand -->
    <a href="/" class="text-xl font-bold text-white">â˜• Cafe Reserve</a>

    <!-- Spacer -->
    <div class="flex-1" />

    <!-- Desktop quick nav (optional shortcuts) -->
    <nav class="hidden md:flex items-center gap-6">
      <a href="/reservations" class="text-secondary-200 hover:text-white transition-colors">Reservations</a>
      <a href="/tables" class="text-secondary-200 hover:text-white transition-colors">Tables</a>
      {isAuthenticated && (
        <a href="/profile" class="text-secondary-200 hover:text-white transition-colors">Profile</a>
      )}
      {isAdmin && (
        <a href="/admin" class="text-secondary-200 hover:text-white transition-colors bg-red-600 px-3 py-1 rounded-md">Admin</a>
      )}
      {!isAuthenticated ? (
        <a href="/login" class="text-secondary-200 hover:text-white transition-colors">Login</a>
      ) : (
        <button id="logout-btn" class="text-secondary-200 hover:text-white transition-colors">Logout</button>
      )}
    </nav>
  </div>
</header>

<script>
  // Mobile menu toggle functionality
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  
  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });

  // Logout functionality
  document.getElementById('logout-btn')?.addEventListener('click', async () => {
    try {
      const { supabase } = await import('../lib/supabase.js');
      await supabase.auth.signOut();
      window.location.href = '/';
    } catch (error) {
      console.error('Error logging out:', error);
    }
  });
</script> 